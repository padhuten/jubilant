{% extends "layout.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product.css') }}">
<script src="{{ url_for('static', filename='javascript/product_detail.js') }}"></script>
{% endblock %}

{% block content %}

<section id="product_head">
  <div class="product-container">

    <!-- LEFT: IMAGE GALLERY -->
    <div class="product-gallery">

      <div class="main-image" id="mainImageContainer">
        <button class="nav-btn nav-left" id="prevBtn">&#10094;</button>
        <img id="prodImage" src="" alt="Product Image">
        <button class="nav-btn nav-right" id="nextBtn">&#10095;</button>
      </div>

      <div class="thumbnail-row" id="thumbRow">
        <!-- Thumbnails injected dynamically -->
      </div>

    </div>

    <!-- RIGHT: PRODUCT DETAILS -->
    <div class="product-details">

      <h1 id="prodName">Loading...</h1>

      <p class="description" id="prodDescription"></p>

      <div class="price-box">
        <span class="price" id="prodPrice"></span>
        <small>10 pcs (MOQ)</small>
      </div>

      <div class="details-meta"><strong>Category:</strong> <span id="prodCategory"></span></div>
      <div class="details-meta"><strong>Brand:</strong> <span id="prodBrand"></span></div>

      <div class="info-icons">
        <div>100% Genuine</div>
        <div>Fast Delivery</div>
        <div>Bulk Discount</div>
        <div>Secure Checkout</div>
      </div>
      
      <!-- Add this code in product.html, right BEFORE the payment-shipping-section div -->
<!-- Add this code in product.html, right BEFORE the payment-shipping-section div -->

<!-- Inquiry Button Section -->
<div class="inquiry-button-section">
  <button class="inquiry-btn" onclick="openInquiryModal()">
    <span class="inquiry-icon">ðŸ’¬</span>
    <span class="inquiry-text">Send Inquiry</span>
  </button>
</div>

<!-- Inquiry Modal -->
<div class="inquiry-modal-overlay" id="inquiryModalOverlay" onclick="closeInquiryModal()"></div>

<div class="inquiry-modal" id="inquiryModal">
  <div class="inquiry-modal-header">
    <h3>Product Inquiry</h3>
    <button class="inquiry-modal-close" onclick="closeInquiryModal()">âœ•</button>
  </div>
  
  <div class="inquiry-modal-body">
    <form id="inquiryForm" novalidate>
      <!-- Hidden fields with product data -->
      <input type="hidden" name="product" id="inquiryProduct">
      <input type="hidden" name="category" id="inquiryCategory">
      <input type="hidden" name="brand" id="inquiryBrand">
      
      <div class="form-group">
        <label>Product Name</label>
        <input type="text" id="displayProduct" readonly class="readonly-input">
      </div>
      
      <div class="form-group">
        <label>Your Name *</label>
        <input type="text" name="name" placeholder="Enter your name" required>
      </div>
      
      <div class="form-group">
        <label>Email Address *</label>
        <input type="email" name="email" placeholder="Enter your email" required>
      </div>
      
      <div class="form-group">
        <label>Phone Number</label>
        <input type="tel" name="phone" placeholder="Enter your phone number">
      </div>
      
      <div class="form-group">
        <label>Quantity *</label>
        <input type="number" name="quantity" placeholder="Enter quantity" min="1" value="10" required>
      </div>
      
      <div class="form-group">
        <label>Inquiry Details</label>
        <textarea name="message" rows="4" placeholder="Additional information or questions..."></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn-cancel" onclick="closeInquiryModal()">Cancel</button>
        <button type="submit" class="btn-submit">Send Inquiry</button>
      </div>
      
      <div id="inquiryFormMessage" class="form-message"></div>
    </form>
  </div>
</div>

<script>
// Open inquiry modal with product data
function openInquiryModal() {
  const productName = document.getElementById('prodName').textContent;
  const productCategory = document.getElementById('prodCategory').textContent;
  const productBrand = document.getElementById('prodBrand').textContent;
  
  // Set hidden fields
  document.getElementById('inquiryProduct').value = productName;
  document.getElementById('inquiryCategory').value = productCategory;
  document.getElementById('inquiryBrand').value = productBrand;
  
  // Set readonly display field
  document.getElementById('displayProduct').value = productName;
  
  // Show modal
  document.getElementById('inquiryModalOverlay').classList.add('active');
  document.getElementById('inquiryModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

// Close inquiry modal
function closeInquiryModal() {
  document.getElementById('inquiryModalOverlay').classList.remove('active');
  document.getElementById('inquiryModal').classList.remove('active');
  document.body.style.overflow = 'auto';
}

// Handle form submission
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('inquiryForm');
  const messageBox = document.getElementById('inquiryFormMessage');
  
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitBtn = form.querySelector('.btn-submit');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    messageBox.style.display = 'none';
    
    const formData = new FormData(form);
    
    try {
      const res = await fetch('/send-inquiry', {
        method: 'POST',
        body: formData
      });
      
      if (res.ok) {
        messageBox.textContent = 'Inquiry sent successfully! ðŸŽ‰';
        messageBox.className = 'form-message success';
        messageBox.style.display = 'block';
        form.reset();
        
        // Close modal after 2 seconds
        setTimeout(() => {
          closeInquiryModal();
        }, 2000);
      } else {
        throw new Error('Server error');
      }
    } catch (error) {
      messageBox.textContent = 'Unable to send inquiry ðŸ˜ž Please try again.';
      messageBox.className = 'form-message error';
      messageBox.style.display = 'block';
    }
    
    submitBtn.disabled = false;
    submitBtn.textContent = 'Send Inquiry';
  });
});

// Close modal on Escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeInquiryModal();
  }
});
</script>
      <!-- Payment & Shipping Section -->
      <div class="payment-shipping-section">
        <div>
          <h4>Payment:</h4>
          <div class="payment-methods">
            <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_37x23.jpg" alt="PayPal">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/200px-Visa_Inc._logo.svg.png" alt="Visa">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/200px-Mastercard-logo.svg.png" alt="Mastercard">
          </div>
        </div>

        <div>
          <h4>Shipping:</h4>
          <div class="shipping-methods">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/DHL_Logo.svg/200px-DHL_Logo.svg.png" alt="DHL">
            <img src="https://centurytech.sg/wp-content/uploads/2023/12/ems.png" alt="EMS">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/FedEx_Express.svg/200px-FedEx_Express.svg.png" alt="FedEx">
            <img src="https://1000logos.net/wp-content/uploads/2017/06/UPS-Logo.png" alt="UPS">
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ======================== -->
<!-- TABS SECTION -->
<!-- ======================== -->

<section id="product_description">
  <div class="tabs">

    <input type="radio" name="tab" id="tab-desc" checked>
    <label for="tab-desc">Description</label>

    <input type="radio" name="tab" id="tab-info">
    <label for="tab-info">Additional Information</label>

    <input type="radio" name="tab" id="tab-warr">
    <label for="tab-warr">Warranty</label>

    <div class="tab-content">

      <div id="desc" class="pane">
        <h3>Product Description</h3>
        <p id="tabDescription"></p>
      </div>

      <div id="info" class="pane">
        <h3>Additional Information</h3>
        <table id="additionalInfoTable"></table>
      </div>

      <div id="warr" class="pane">
        <h3>Warranty</h3>
        <p id="prodWarranty"></p>
      </div>

    </div>
  </div>
</section>


<script>
  const container = document.getElementById("mainImageContainer");
  const img = document.getElementById("prodImage");

  container.addEventListener("mouseenter", () => {
    if (!img.src) return;
    container.classList.add("zooming");
    container.style.backgroundImage = `url('${img.src}')`;
  });

  container.addEventListener("mouseleave", () => {
    container.classList.remove("zooming");
    container.style.backgroundImage = "none";
  });

  container.addEventListener("mousemove", (e) => {
    if (!img.src) return;
    const rect = container.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;
    container.style.backgroundPosition = `${x}% ${y}%`;
  });
</script>

{% endblock %}
