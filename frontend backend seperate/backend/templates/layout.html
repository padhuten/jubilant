<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{{ title or "Jubilant Tech - Your Global IT Partner" }}</title>

    <!-- GLOBAL BASE LAYOUT CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">

    <!-- GLOBAL HEADER CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">

    <!-- GLOBAL FOOTER CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">

    <!-- INQUIRY BUTTON CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/inquiry-button.css') }}">

    <!-- BOOTSTRAP -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- PAGE-SPECIFIC CSS -->
    {% block styles %}{% endblock %}

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="/static/images/jubiliant-logo.webp">

    <script src="https://unpkg.com/feather-icons"></script>
</head>

<!-- ⭐⭐ PAGE-LEVEL CLASS — lets index become full width -->
<body class="{% block body_class %}home-page{% endblock %}">

    {% include "components/header.html" %}

    <!-- ⭐⭐ MAIN WRAPPER: now flexible, no fixed width -->
    <main class="page-wrapper">
        {% block content %}{% endblock %}
    </main>

    {% include "components/footer.html" %}

    <!-- INQUIRY BUTTON COMPONENT -->
    {% include "components/inquiry_modal.html" %}

    <script>
        feather.replace();
    </script>

    <!-- INQUIRY BUTTON JAVASCRIPT - Inline to ensure it loads -->
    <script>
        console.log("✅ Inquiry Button JS Inline Loaded");

        function toggleInquiryModal(action) {
            console.log("toggleInquiryModal called with action:", action);
            const modal = document.getElementById("inquiryModal");
            console.log("Modal element found:", modal);
            
            if (action === "open") {
                console.log("Opening modal");
                modal.style.display = "flex";
                document.body.style.overflow = "hidden"; // Prevent scrolling
                // Hide header and footer
                document.querySelector("header")?.style.display === "none" ? null : document.querySelector("header").style.display = "none";
                document.querySelector("footer")?.style.display === "none" ? null : document.querySelector("footer").style.display = "none";
            } else if (action === "close") {
                console.log("Closing modal");
                modal.style.display = "none";
                document.body.style.overflow = "auto"; // Re-enable scrolling
                // Show header and footer
                const header = document.querySelector("header");
                const footer = document.querySelector("footer");
                if (header) header.style.display = "block";
                if (footer) footer.style.display = "block";
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            console.log("DOMContentLoaded fired");
            
            const modal = document.getElementById("inquiryModal");
            const inquiryForm = document.getElementById("inquiryForm");
            
            console.log("Modal element:", modal);
            console.log("Form element:", inquiryForm);
            
            // Close modal when clicking outside
            window.addEventListener("click", function(event) {
                if (event.target === modal) {
                    console.log("Clicked outside modal");
                    toggleInquiryModal("close");
                }
            });

            // Close modal with Escape key
            document.addEventListener("keydown", function(event) {
                if (event.key === "Escape" && modal.style.display === "flex") {
                    console.log("Escape key pressed");
                    toggleInquiryModal("close");
                }
            });

            // Handle form submission
            if (inquiryForm) {
                console.log("Setting up form submission handler");
                inquiryForm.addEventListener("submit", async function(e) {
                    e.preventDefault();
                    console.log("Form submitted");

                    const successMsg = document.getElementById("inquirySuccessMsg");
                    const errorMsg = document.getElementById("inquiryErrorMsg");
                    const submitBtn = inquiryForm.querySelector(".submit-button");

                    // Clear messages
                    successMsg.style.display = "none";
                    errorMsg.style.display = "none";

                    // Disable button
                    submitBtn.disabled = true;
                    submitBtn.textContent = "Sending...";

                    const formData = new FormData(this);

                    try {
                        console.log("Sending form data to /send-inquiry");
                        const response = await fetch("/send-inquiry", {
                            method: "POST",
                            body: formData
                        });

                        const result = await response.json();
                        console.log("Response from server:", result);

                        if (result.success) {
                            successMsg.textContent = result.message || "✅ Inquiry sent successfully! We'll contact you soon.";
                            successMsg.style.display = "block";
                            inquiryForm.reset();

                            setTimeout(() => {
                                toggleInquiryModal("close");
                                submitBtn.disabled = false;
                                submitBtn.textContent = "Send Inquiry";
                            }, 2500);
                        } else {
                            errorMsg.textContent = "❌ " + (result.message || "Failed to send inquiry.");
                            errorMsg.style.display = "block";
                            submitBtn.disabled = false;
                            submitBtn.textContent = "Send Inquiry";
                        }
                    } catch (error) {
                        console.error("Error caught:", error);
                        errorMsg.textContent = "❌ Error sending inquiry. Please try again.";
                        errorMsg.style.display = "block";
                        submitBtn.disabled = false;
                        submitBtn.textContent = "Send Inquiry";
                    }
                });
            } else {
                console.log("⚠️ Form element NOT found!");
            }
        });
    </script>

</body>
</html>